<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Depy - Simple and nearly dependency free deployment tool | Ivan Dokov - Web Expert</title>
    <meta name="description" content="Bash based deployment tool for zero downtime website deployment and instant rollbacks in case of emergency">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700&amp;display=swap">
  <link rel="me" href="https://twitter.com/ivandokov">
  <link rel="webmention" href="https://webmention.io/dokov.bg/webmention">
  <link rel="pingback" href="https://webmention.io/dokov.bg/xmlrpc">
  <link rel="alternate" href="https://dokov.bg/rss.xml" type="application/atom+xml" title="Ivan Dokov - blog for web related stuff">
    
    <link rel="preload" href="/assets/css/0.styles.91129331.css" as="style"><link rel="preload" href="/assets/js/app.9a4127f6.js" as="script"><link rel="preload" href="/assets/js/4.1d1fcec0.js" as="script"><link rel="preload" href="/assets/js/8.ec448cac.js" as="script"><link rel="prefetch" href="/assets/js/1.9f88e0c1.js"><link rel="prefetch" href="/assets/js/10.c9e51687.js"><link rel="prefetch" href="/assets/js/11.e5ccc9f5.js"><link rel="prefetch" href="/assets/js/12.bde775d4.js"><link rel="prefetch" href="/assets/js/13.05136ff6.js"><link rel="prefetch" href="/assets/js/14.6829c8e6.js"><link rel="prefetch" href="/assets/js/15.7061f23c.js"><link rel="prefetch" href="/assets/js/16.469ec5b0.js"><link rel="prefetch" href="/assets/js/3.d15b0ca6.js"><link rel="prefetch" href="/assets/js/5.7c38f7af.js"><link rel="prefetch" href="/assets/js/6.d058e63c.js"><link rel="prefetch" href="/assets/js/7.190aeb18.js"><link rel="prefetch" href="/assets/js/9.0c85441e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.91129331.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="pb-12 px-3 md:px-0 font-sans text-secondary"><div class="container flex flex-wrap"><section class="max-h-screen overflow-auto md:sticky md:top-0 pt-12 w-full md:w-1/4 md:text-right"><div class="mb-10"><a href="/" class="block w-1/3 sm:w-1/5 md:w-auto mx-auto md:ml-4 lg:ml-16 md:mr-1 md:pr-10 router-link-active"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 199.6 55.5"><path fill="#4385ef" d="M15.2 55.5c-3.7-1-6.3-2.7-7.9-5S5 45.5 5 42.3v-5.8c0-1.9-.4-3.3-1.2-4.4-.8-1-2.1-1.6-3.8-1.6v-5.7c1.7 0 3-.5 3.8-1.5.8-1 1.2-2.4 1.2-4.3v-5.8c0-3.2.8-6 2.4-8.2 1.6-2.3 4.2-3.9 7.9-5l1.6 4.5c-1.6.6-2.7 1.6-3.4 3.1-.7 1.5-1 3.4-1 5.6V19c0 2-.4 3.7-1.3 5.2-.8 1.5-2.1 2.7-3.8 3.6 1.7.9 3 2.1 3.8 3.6.8 1.5 1.3 3.2 1.3 5.2v5.8c0 2.2.3 4.1 1 5.6s1.8 2.5 3.4 3.1l-1.7 4.4z"></path><path fill="#3F454C" d="M21.7 48.3V7h14.2c5 0 9.2 1.6 12.5 4.8 3.3 3.2 4.9 7.4 4.9 12.4V31c0 5.1-1.6 9.2-4.9 12.4-3.3 3.2-7.4 4.8-12.5 4.8H21.7zM30 13.4v28.5h5.5c3 0 5.3-1 7-3 1.7-2 2.5-4.6 2.5-7.9v-6.9c0-3.2-.8-5.8-2.5-7.8s-4-3-7-3H30zM57.8 32.7c0-4.6 1.3-8.3 3.8-11.2 2.6-2.9 6.1-4.4 10.6-4.4s8.1 1.5 10.7 4.4 3.9 6.7 3.9 11.3v.6c0 4.6-1.3 8.4-3.8 11.3-2.6 2.9-6.1 4.4-10.6 4.4s-8.1-1.5-10.7-4.4c-2.6-2.9-3.8-6.7-3.8-11.3v-.7zm8.2.6c0 2.8.5 5 1.5 6.7 1 1.7 2.6 2.5 4.8 2.5 2.1 0 3.7-.9 4.7-2.5 1-1.7 1.5-3.9 1.5-6.7v-.6c0-2.7-.5-4.9-1.5-6.7-1-1.7-2.6-2.6-4.7-2.6s-3.7.9-4.7 2.6c-1 1.7-1.5 3.9-1.5 6.6v.7zM102.4 35.5h-2.3v12.9h-8.3V4h8.3v25.1h2l7.1-11.5h9.6L109 31.5l11.3 16.8h-9.5l-8.4-12.8zM121.7 32.7c0-4.6 1.3-8.3 3.8-11.2 2.6-2.9 6.1-4.4 10.6-4.4s8.1 1.5 10.7 4.4 3.9 6.7 3.9 11.3v.6c0 4.6-1.3 8.4-3.8 11.3-2.6 2.9-6.1 4.4-10.6 4.4s-8.1-1.5-10.7-4.4c-2.6-2.9-3.8-6.7-3.8-11.3v-.7zm8.3.6c0 2.8.5 5 1.5 6.7 1 1.7 2.6 2.5 4.8 2.5 2.1 0 3.7-.9 4.7-2.5 1-1.7 1.5-3.9 1.5-6.7v-.6c0-2.7-.5-4.9-1.5-6.7-1-1.7-2.6-2.6-4.7-2.6s-3.7.9-4.7 2.6c-1 1.7-1.5 3.9-1.5 6.6v.7zM166.4 36.9l.5 2.8h.2l.6-2.8 5-19.3h8.7L171 48.3h-8l-10.4-30.7h8.7l5.1 19.3z"></path><path fill="#4385ef" d="M182.8 51c1.6-.6 2.7-1.6 3.4-3.1.7-1.5 1-3.4 1-5.6v-5.8c0-2 .4-3.7 1.3-5.2s2.2-2.7 4-3.5c-1.8-.9-3.1-2-4-3.6-.9-1.5-1.3-3.3-1.3-5.3v-5.8c0-2.2-.3-4.1-1-5.6s-1.8-2.5-3.4-3.1l1.6-4.5c3.7 1 6.3 2.7 7.9 5 1.6 2.3 2.4 5 2.4 8.2V19c0 1.9.4 3.4 1.2 4.4.8 1 2.1 1.5 3.8 1.5v5.7c-1.7 0-3 .5-3.8 1.6-.8 1-1.2 2.5-1.2 4.4v5.8c0 3.2-.8 6-2.4 8.3-1.6 2.3-4.2 3.9-7.9 5l-1.6-4.7z"></path></svg></a></div> <div class="py-1"><aside class="md:pr-10 md:border-r border-gray-100"><nav class="mb-5 -mt-2 text-center md:text-right"><div class="inline md:block -mr-1 mb-5"><a href="/" class="p-2 hover:text-primary hover:underline router-link-active text-primary">Blog</a> <a href="/about/" class="p-2 hover:text-primary hover:underline">About</a></div> <div class="inline md:block ml-2 md:ml-0 text-xs text-gray-500"><a href="https://github.com/ivandokov" target="_blank" rel="me" class="p-1 hover:text-primary hover:underline">GitHub</a> <a href="https://twitter.com/ivandokov" target="_blank" rel="me" class="p-1 hover:text-primary hover:underline">Twitter</a> <a href="#" class="p-1 hover:underline">Email</a> <a href="/rss.xml" class="p-1 hover:underline">RSS</a></div></nav> <nav class="mb-5 font-sm text-center md:text-right"><div class="inline md:block"><a href="/" class="p-2 md:p-0 whitespace-no-wrap router-link-active"><span class="hover:text-primary hover:underline">All posts</span> <span class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-gray-100 text-gray-500 text-xs">5</span></a></div> <div class="inline md:block"><a href="/bootstrap/" class="p-2 md:p-0 whitespace-no-wrap"><span class="hover:text-primary hover:underline">Bootstrap</span> <span class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-gray-100 text-gray-500 text-xs">1</span></a></div><div class="inline md:block"><a href="/depy/" class="p-2 md:p-0 whitespace-no-wrap router-link-active text-primary"><span class="hover:text-primary hover:underline">Depy</span> <span class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-gray-100 text-gray-500 text-xs">1</span></a></div><div class="inline md:block"><a href="/servers/" class="p-2 md:p-0 whitespace-no-wrap"><span class="hover:text-primary hover:underline">Servers</span> <span class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-gray-100 text-gray-500 text-xs">1</span></a></div><div class="inline md:block"><a href="/tools/" class="p-2 md:p-0 whitespace-no-wrap"><span class="hover:text-primary hover:underline">Tools</span> <span class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-gray-100 text-gray-500 text-xs">2</span></a></div></nav> <div class="leading-tight"><input aria-label="Search" autocomplete="off" spellcheck="false" placeholder="Search" value="" class="w-full mb-2 px-2 py-1 text-xs text-center md:text-right outline-none border-b border-transparent focus:border-gray-100 text-secondary placeholder-gray-500 hover:placeholder-primary"> <!----></div></aside> <footer class="mb-5 pt-6 md:pr-10 md:border-r border-gray-100 text-xs text-gray-300 text-center md:text-right">
            Â© 2006 - 2019 Ivan Dokov
        </footer></div></section> <main class="w-full md:w-3/4 md:pl-10 md:pt-24 mt-6 text-lg leading-relaxed"><article><div class="content-body -mt-2 content__default"><h1 id="depy"><a href="#depy" class="header-anchor">#</a> Depy</h1> <h3 id="simple-and-nearly-dependency-free-deployment-tool"><a href="#simple-and-nearly-dependency-free-deployment-tool" class="header-anchor">#</a> Simple and nearly dependency free deployment tool.</h3> <p><img src="/assets/img/depy.e83e1230.jpg" alt="Depy"></p> <p>Written in <code>bash</code> the tool does not have any major dependencies. Everything you need to have installed locally is:</p> <ul><li><code>git</code> (<em>download Depy and for updates</em>)</li> <li><code>ssh</code> (<em>communicate with the server</em>)</li> <li><code>rsync</code> (<em>transfer files</em>)</li> <li><code>zip</code> (<em>pack releases</em>)*</li></ul> <p>On the server you need to have:</p> <ul><li><code>unzip</code> (unpack releases)*</li></ul> <p>* <em>This <a href="https://github.com/ivandokov/depy/issues/22" target="_blank" rel="noopener noreferrer">could change<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in a future release.</em></p> <p>These are basic tools which you probably have installed already on your system. For installation and configuration please head over to the <a href="https://github.com/ivandokov/depy" target="_blank" rel="noopener noreferrer">repository documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="why"><a href="#why" class="header-anchor">#</a> Why</h2> <p>You may ask why I have developed this tool when there are so many other tools that already do more. The answer is pretty simple - for fun. Well not only for fun, but it was fun do code it. Also I didn't like the tool that we used in the company where I worked at the time of the initial Depy release. It had its quirks and wasn't really easy to do something that's not included out of the box. Infact Depy is heavily inspired by this tool - <a href="http://rocketeer.autopergamene.eu/" target="_blank" rel="noopener noreferrer">Rocketeer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which is inspired by <a href="https://capistranorb.com" target="_blank" rel="noopener noreferrer">Capistrano<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. I love writing bash scripts that do my life easier and as far as I remember we had a hard time making Rocketeer do something simple on the server which was super easy with a single bash script. Don't get me wrong, Rocketeer is a great tool. It is probably even better now, but I just felt it is not the perfect tool for the job. So I decided to do it easier and with less dependencies. I really do not like the deployment tool to be dependent on the software it will deploy. It should be more generic and give full freedom for the person who setup the deployment process to do whatever he/she desires and with any tool/language that is installed on the server or locally.</p> <h2 id="zero-downtime-deployment"><a href="#zero-downtime-deployment" class="header-anchor">#</a> Zero downtime deployment</h2> <p>Same as Rocketeer Depy offers zero downtime deployment using symlinks on the server. When a new release is deployed it is first prepared in its own directory and if the preparation steps are completed without an error the release is symlined as <code>current</code> and if the web server is configured properly to serve the <code>current</code> directory as web root everything will be updated for the website visitors in an instant.</p> <h2 id="releases-and-rollbacks"><a href="#releases-and-rollbacks" class="header-anchor">#</a> Releases and rollbacks</h2> <p>At any given time any release can be symlinked as <code>current</code> and baically this is the rollback functionality. Depy keeps 4 releases on the server by default but this can be changed and you can keep as many as you think are necessary.</p> <h2 id="the-freedom"><a href="#the-freedom" class="header-anchor">#</a> The freedom</h2> <p>Depy's main architecture goal is to be without limitations. You should be able to do whatever you need and do it intuitively. To accomplish this I added hooks in the process of deployment where you can execute any code you need. These hooks are bash scripts that are ran on a specific enviroment, either locally or on the target server.
Depy has the following hooks:</p> <ul><li><strong>Pre hook</strong> <code>.depy-pre.sh</code> - This is an <strong>optional</strong> script that is executed locally in the project directory before the actual deployment process. It is a great place to make sure that you are not deploying broken code to the server. You can use it to execute tests, builds, etc. If the hook exits with code other than 0 the deployment process will be cancelled and marked as failed.</li> <li><strong>Remote hook</strong> <code>.depy-remote.sh</code> - This is an <strong>optional</strong> script that is executed on the server in the new release folder before the linking of the release as current. This hook is used to install dependencies, make builds and for clean up work on the server. If the hook exits with code other than 0 the deployment process will be cancelled and marked as failed.</li> <li><strong>Remote post link hook</strong> <code>.depy-remote-post-link.sh</code> - This is an <strong>optional</strong> script that is executed on the server in the new release folder after the linking of the release as current. This hook is used to execute code on the server after the current release is updated. For example restarting workers which depend on the current release path to point to the new code. If the hook exits with code other than 0 the deployment process will not be cancelled but marked as failed.</li> <li><strong>Post hook</strong> <code>.depy-post.sh</code> - This is an <strong>optional</strong> script that is executed locally in the project directory after the actual deployment process. This hook is used for clean up work, announcing deploy status (for example in a Slack channel), etc. If the hook exits with code other than 0 the deployment process will be marked as failed, but cannot be cancelled because the remote stuff are already done.</li></ul> <h2 id="status"><a href="#status" class="header-anchor">#</a> Status</h2> <p>I've been using Depy for the past 3 years and I did some breaking changes but it is pretty stable at the moment and I have deployed to production and staging servers more than 10 projects with different needs. I have some plans to rewrite everything in Go and release binaries for Linux, Mac and maybe even Windows, but this is just an idea and it will heavily depend on my free time which I rarely have. But even if I do not rewrite it in Go it is just fine as it is right now and this rewrite idea could be only a way to scratch my itch to do something meaningful in Go and it will probably pass.</p> <p>For more information please go to the <a href="https://github.com/ivandokov/depy" target="_blank" rel="noopener noreferrer">repository documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <aside class="border border-l-0 border-r-0 border-gray-300 my-12 py-10 text-xs text-gray-500">
        In <a href="/depy/" class="text-primary hover:underline router-link-active">Depy</a> September 3, 2019
    </aside> <aside class="flex leading-tight"><div class="w-1/2 pr-2"><a href="/servers/nginx-geoip2-ubuntu/" class="prev"><strong>Installing Nginx with GeoIP2 on Ubuntu</strong></a></div> <div class="w-1/2 pl-2 text-right"><a href="/bootstrap/bootstrap-font-sizes/"><strong>Bootstrap 4 Font Sizes</strong></a></div></aside></article></main></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9a4127f6.js" defer></script><script src="/assets/js/4.1d1fcec0.js" defer></script><script src="/assets/js/8.ec448cac.js" defer></script>
  </body>
</html>
